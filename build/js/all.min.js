/*! ukulelejs2 2015-06-08 */
function Ukulele(){"use strict";function a(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;e++)d=d[c[e]];return d}function b(a){var b=a.split(".");return b.shift(),b.join(".")}function c(a){return a.attr("uku-repeat")?!0:!1}function d(a){for(var b=a.parents(),c=0;c<b.length;c++){var d=b[c],e=$(d).attr("uku-repeat");if(e)return!0}return!1}this.controllersDefinition={},this.viewControllerArray=[];var e,f={},g=this,h=function(){for(var b in g.controllersDefinition){for(var c=g.controllersDefinition[b],d=c.controllerInstance,i=f[b],j=0;j<c.boundAttrs.length;j++){var k=c.boundAttrs[j],l=k.attributeName;if(i){var m=a(d,l),n=a(i,l);m!==n&&(null!==k.expression?k.renderExpression(d):"repeat"!==k.ukuTag?k.renderAttribute(d):k.renderRepeat(d))}}i=jQuery.extend(!0,{},d),delete f[b],f[b]=i}e=setTimeout(h,500)},i=function(){$("[uku-application]").each(function(){j($(this))})},j=function(e){function f(a){-1!=a.directText().search("{{")&&(c(a)||d(a)||h(a)),a.children().each(function(){f($(this))})}function h(c){var d=c.directText();if(d.search("{{")>-1&&d.search("}}")>-1){var e=d.slice(2,-2),f=m(e),g=f.controllerInstance;e=b(e),c.directText(a(g,e));var h=new BoundAttribute(e,null,d,c);f.addBoundAttr(h)}}function i(c,d){var e=c.attr("uku-"+d),f=m(e),g=f.controllerInstance;e=b(e),c.attr(d,a(g,e));var h=new BoundAttribute(e,d,null,c);f.addBoundAttr(h);var i=c[0].tagName;"INPUT"==i&&"value"==d&&c.change(function(){for(var a=e.split("."),b=g,d=0;d<a.length-1;d++)b=b[a[d]];b[a[a.length-1]]=c.val()})}function j(a,c){var d=a.attr("uku-"+c),e=m(d),f=e.controllerInstance,g=c.substring(2),h=d.split("(")[0];h=b(h),a.bind(g,function(){var a,b,c=h.split(".");1==c.length?(a=h,b=f):alert("current version does not support deep function definition"),b[a]()})}function k(a){var c=a.attr("uku-repeat"),d=c.split(" in "),e=d[0],f=d[1],g=m(f),h=g.controllerInstance;f=b(f);var i=new BoundAttribute(f,"repeat",e,a);g.addBoundAttr(i),i.renderRepeat(h)}function l(a){var b=a.split(".")[0];return b?b:null}function m(a){var b=l(a),c=g.controllersDefinition[b];return c}var n=[];e.find("*").each(function(){var a=$(this).fuzzyFind("uku-");c($(a))&&!d($(a))&&n.push(a)}),f(e);for(var o=0;o<n.length;o++)for(var p=n[o],q=0;q<p.attributes.length;q++){var r=p.attributes[q];if(r.nodeName.search("uku-")>-1){var s=r.nodeName.split("-")[1];0===s.search("on")?c($(p))||d($(p))||j($(p),s):-1!==s.search("repeat")?k($(p)):c($(p))||d($(p))||i($(p),s)}}};return{init:function(){$(document).ready(function(){i(),h()})},registerController:function(a,b){g.viewControllerArray.push({view:$(this),controller:b});var c=new ControllerModel(b);g.controllersDefinition[a]=c},dealWithElement:function(a){j(a),h()}}}function BoundAttribute(a,b,c,d){"use strict";this.attributeName=a,this.ukuTag=b,this.expression=c,this.element=d,this.renderTemplate,this.parentElement,"repeat"===b&&(this.renderTemplate=d.prop("outerHTML"),this.parentElement=d.parent())}function ControllerModel(a){"use strict";this.controllerInstance=a,this.boundAttrs=[],this.addBoundAttr=function(a){this.boundAttrs.push(a)},this.getBoundAttrByName=function(a){for(var b=[],c=0;c<this.boundAttrs.length;c++){var d=this.boundAttrs[c];d.attributeName===a&&b.push(d)}return b}}!function(a){a.fn.directText=function(b){var c="";return this.each(function(){for(var d=this.childNodes,e=0;e<=d.length-1;e++){var f=d[e];if(3==f.nodeType){if(b&&""!=a.trim(f.nodeValue))return void(f.nodeValue=b);c+=f.nodeValue}}}),a.trim(c)},a.fn.fuzzyFind=function(a){if(this.hasOwnProperty("context")){var b=this.context;if(b&&b.hasOwnProperty("attributes"))for(var c=0;c<b.attributes.length;c++){var d=b.attributes[c];if(d.nodeName.search(a)>-1)return b}}return null}}(jQuery),BoundAttribute.prototype.renderAttribute=function(a){for(var b=this.attributeName.split("."),c=a,d=0;d<b.length;d++)c=c[b[d]];this.element.attr(this.ukuTag,c)},BoundAttribute.prototype.renderExpression=function(a){this.element.directText(a[this.attributeName])},BoundAttribute.prototype.renderRepeat=function(a){this.parentElement.children().remove();for(var b in a[this.attributeName]){var c=a[this.attributeName][b],d=$(this.renderTemplate).removeAttr("uku-repeat");this.parentElement.append(d);var e=new Ukulele;e.registerController(this.expression,c),e.dealWithElement(d)}};