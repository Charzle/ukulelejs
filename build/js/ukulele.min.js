/*! ukulelejs 2015-09-03 */
function elementChangedBinder(a,b,c,d){for(var e=[inputTextCase,selectCase,checkboxCase,radioCase],f=0;f<e.length;f++){var g=e[f],h=g.apply(this,arguments);if(h)break}}function inputTextCase(a,b,c,d){var e=a.tagName;return"INPUT"===e&&"text"===a.getAttribute("type")&&"value"===b?(a.addEventListener("change",function(e){var f=a.getAttribute("uku-"+b);f=UkuleleUtil.getFinalAttribute(f);for(var g=f.split("."),h=c.controllerInstance,i=0;i<g.length-1;i++)h=h[g[i]];h[g[g.length-1]]=a.value,d&&d()}),!0):!1}function selectCase(a,b,c,d){var e=a.tagName;return"SELECT"===e&&"selected"===b?(a.addEventListener("change",function(e){var f,g=a.getAttribute("uku-"+b),h=g.split("|");g=h[0],f=h[1],g=UkuleleUtil.getFinalAttribute(g);for(var i=g.split("."),j=c.controllerInstance,k=0;k<i.length-1;k++)j=j[i[k]];for(var l=a.querySelectorAll("option"),m=0;m<l.length;m++){var n=l[m];if(n.selected){var o=JSON.parse(n.getAttribute("data-item"));j[i[i.length-1]]=o}}d&&d()}),!0):!1}function checkboxCase(a,b,c,d){var e=a.tagName;return"INPUT"===e&&"value"===b&&"checkbox"===a.getAttribute("type")?(a.addEventListener("change",function(e){var f=a.getAttribute("uku-"+b);f=UkuleleUtil.getFinalAttribute(f);for(var g=f.split("."),h=c.controllerInstance,i=0;i<g.length-1;i++)h=h[g[i]];h[g[g.length-1]]=a.checked,d&&d()}),!0):!1}function radioCase(a,b,c,d){var e=a.tagName;return"INPUT"===e&&"selected"===b&&"radio"===a.getAttribute("type")?(a.addEventListener("change",function(e){var f=a.getAttribute("uku-"+b);f=UkuleleUtil.getFinalAttribute(f);for(var g=f.split("."),h=c.controllerInstance,i=0;i<g.length-1;i++)h=h[g[i]];a.checked&&(h[g[g.length-1]]=a.value,d&&d())}),!0):!1}function Ukulele(){"use strict";function a(){for(var a in h){for(var b=h[a],d=b.controllerInstance,e=i[a],f=0;f<b.boundItems.length;f++){var g=b.boundItems[f],k=g.attributeName;if(e){"selected"===g.ukuTag&&(k=k.split("|")[0]);var l=UkuleleUtil.getFinalValue(j,d,k),m=UkuleleUtil.getFinalValue(j,e,k);if(!ObjectUtil.compare(m,l)){k=g.attributeName;for(var n=b.getBoundItemsByName(k),o=0;o<n.length;o++){var p=n[o];p.render(d)}j.refreshHandler&&j.refreshHandler.call(j)}}}c(d,a)}}function b(){for(var a in h){var b=h[a],d=b.controllerInstance;c(d,a)}}function c(a,b){var c=ObjectUtil.deepClone(a);delete i[b],i[b]=c}function d(d){function g(a,b){function c(a){function e(a,b){var c=b.split("|");if(c&&2===c.length){var d=c[0],e=c[1];return a=a.replace(new RegExp(d,"gm"),e)}return a}var f=d[a],h=f.getAttribute("load");if("false"===h)a++,a<d.length?c(a):b();else{var i=f.getAttribute("src"),j=f.getAttribute("replace"),k=f.getAttribute("replace-controller"),l=new Ajax;j&&"true"===j?!function(f){l.get(i,function(h){k&&(h=e(h,k)),f.insertAdjacentHTML("beforeBegin",h);var i=f.previousElementSibling;f.parentNode.removeChild(f),g(i,function(){a++,a<d.length?c(a):b()})})}(f):!function(f){l.get(i,function(h){k&&(h=e(h,k)),f.insertAdjacentHTML("afterBegin",h),f.classList.remove("uku-include"),g(f,function(){a++,a<d.length?c(a):b()})})}(f)}}var d=a.querySelectorAll(".uku-include"),e=0;e<d.length?c(e):b()}function h(a){-1!==UkuleleUtil.searchUkuExpTag(Selector.directText(a))&&(UkuleleUtil.isRepeat(a)||UkuleleUtil.isInRepeat(a)||i(a));for(var b=0;b<a.children.length;b++)h(a.children[b])}function i(a){var b=Selector.directText(a);if(-1!==UkuleleUtil.searchUkuExpTag(b)){var c=b.slice(2,-2),d=e(c);if(d){var f=new BoundItemExpression(c,b,a,j);d.addBoundItem(f),f.render(d.controllerInstance)}}}function k(b,d){var f=b.getAttribute("uku-"+d),g=b.tagName,h=f.split(".")[0],i=e(f);if(i){var k=new BoundItemAttribute(f,d,b,j);i.addBoundItem(k),k.render(i.controllerInstance),(("INPUT"===g||"TEXTAREA"===g)&&"value"===d||"SELECT"===g&&"selected"===d||"INPUT"===g&&"selected"===d)&&b.addEventListener("change",function(e){c(i.controllerInstance,h);var j,k;if("SELECT"===g&&"selected"===d){var l=f.split("|");k=l[0],j=l[1]}else k=f;k=UkuleleUtil.getFinalAttribute(k);for(var m=k.split("."),n=i.controllerInstance,o=0;o<m.length-1;o++)n=n[m[o]];if("SELECT"===g&&j)for(var p=b.querySelectorAll("option"),q=0;q<p.length;q++){var r=p[q];if(r.selected){var s=JSON.parse(r.getAttribute("data-item"));n[m[m.length-1]]=s}}else"INPUT"===g&&"checkbox"===b.getAttribute("type")?n[m[m.length-1]]=b.checked:"INPUT"===g&&"radio"===b.getAttribute("type")?b.checked&&(n[m[m.length-1]]=b.value):n[m[m.length-1]]=b.value;a()})}}function l(b,d){var g=b.getAttribute("uku-"+d),h=d.substring(2),i=e(g);if(i){var j,k=i.controllerInstance,l=g.split(".");j="parent"===l[0]?l[1]:l[0],b.addEventListener(h,function(){c(k,j),f(g,arguments),a()})}}function m(a){var b=a.getAttribute("uku-repeat"),c=b.split(" in "),d=c[0],f=c[1],g=e(f);if(g){var h=g.controllerInstance,i=new BoundItemRepeat(f,d,a,j);g.addBoundItem(i),i.render(h)}}d.style.display="none",g(d,function(){var a=[],c=Selector.fuzzyFind(d,"uku-");c&&a.push(c);for(var e=d.querySelectorAll("*"),f=0;f<e.length;f++){var g=e[f],i=Selector.fuzzyFind(g,"uku-");i&&!UkuleleUtil.isInRepeat(i)&&a.push(i)}h(d);for(var n=0;n<a.length;n++)for(var o=a[n],p=0;p<o.attributes.length;p++){var q=o.attributes[p];if(UkuleleUtil.searchUkuAttrTag(q.nodeName)>-1){var r=q.nodeName.split("-");r.shift();var s=r.join("-");"application"!==s&&(0===s.search("on")?UkuleleUtil.isRepeat(o)||UkuleleUtil.isInRepeat(o)||l(o,s):-1!==s.search("repeat")?m(o):UkuleleUtil.isRepeat(o)||UkuleleUtil.isInRepeat(o)||k(o,s))}}j.refreshHandler&&j.refreshHandler.call(j),j.initHandler&&j.initHandler.call(j,d),b(),d.style.display="block"})}function e(a){var b=UkuleleUtil.getBoundModelInstantName(a),c=h[b];if(!c){var d=a.split("."),e=d[0];if("parent"===e&&j.parentUku)return d.shift(),a=d.join("."),j.parentUku.getControllerModelByName(a)}return c}function f(a,b){var c=e(a),d=c.controllerInstance,f=UkuleleUtil.getFinalValue(j,d,a,b);return f}function g(){var a=document.querySelectorAll("[uku-application]");if(1!==a.length)throw new Error("Only one 'uku-application' can be declared in a whole html.");d(a[0])}var h={},i={},j=this;this.refreshHandler=null,this.initHandler=null,this.parentUku=null,this.init=function(){g()},this.registerController=function(a,b){var c=new ControllerModel(b);h[a]=c},this.dealWithElement=function(a){d(a)},this.loadIncludeElement=function(a){"false"===a.getAttribute("load")&&(a.setAttribute("load",!0),d(a.parentNode))},this.getControllerModelByName=function(a){return e(a)},this.refresh=function(){a(),b()},this.getFinalValueByExpression=function(a){var b=this.getControllerModelByName(a).controllerInstance;return UkuleleUtil.getFinalValue(this,b,a)}}function Ajax(){}function Selector(){}function BoundItemAttribute(a,b,c,d){BoundItemBase.call(this,a,c,d),this.ukuTag=b}function BoundItemBase(a,b,c){"use strict";this.attributeName=a,this.element=b,this.uku=c}function BoundItemExpression(a,b,c,d){BoundItemBase.call(this,a,c,d),this.expression=b}function BoundItemRepeat(a,b,c,d){BoundItemBase.call(this,a,c,d),this.expression=b,this.renderTemplate=c.outerHTML,this.parentElement=c.parentNode,this.beginCommentString=void 0,this.endCommentString=void 0}function ControllerModel(a){"use strict";this.controllerInstance=a,this.boundItems=[]}function ObjectUtil(){"use strict"}function UkuleleUtil(){"use strict"}Ajax.prototype.get=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&(200===d.status?b(d.responseText):c&&c())},d.open("GET",a,!0),d.send(null)},Selector.fuzzyFind=function(a,b){if(a&&a.attributes)for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];if(d.nodeName.search(b)>-1)return a}return null},Selector.directText=function(a,b){for(var c="",d=a.childNodes,e=0;e<=d.length-1;e++){var f=d[e];if(3===f.nodeType){if(b||""===b||0===b||b===!1)return void(f.nodeValue=b);c+=f.nodeValue}}return c.trim()},Selector.parents=function(a){for(var b=[];a.parentNode&&"BODY"!==a.parentNode.tagName;)b.push(a.parentNode),a=a.parentNode;return b},BoundItemAttribute.prototype=new BoundItemBase,BoundItemAttribute.prototype.constructor=BoundItemAttribute,BoundItemAttribute.prototype.render=function(a){var b,c=this.attributeName,d=this.element.tagName;if("selected"===this.ukuTag&&"SELECT"===d){var e=this.attributeName.split("|");c=e[0],b=e[1]}var f=UkuleleUtil.getFinalValue(this.uku,a,c);if(-1!==this.ukuTag.search("data-item"))f=JSON.stringify(f),this.element.setAttribute("data-item",f);else if("selected"===this.ukuTag&&"SELECT"===d){var g;g=b?f[b]:f,this.element.value=g}else"checkbox"===this.element.getAttribute("type")?this.element.setAttribute("checked",f):"value"===this.ukuTag?this.element.value=f:"radio"===this.element.getAttribute("type")?this.element.value===f&&this.element.setAttribute("checked",!0):this.element.setAttribute(this.ukuTag,f)},BoundItemExpression.prototype=new BoundItemBase,BoundItemExpression.prototype.constructor=BoundItemExpression,BoundItemExpression.prototype.render=function(a){var b=UkuleleUtil.getFinalValue(this.uku,a,this.attributeName);Selector.directText(this.element,b)},BoundItemRepeat.prototype=new BoundItemBase,BoundItemRepeat.prototype.constructor=BoundItemRepeat,BoundItemRepeat.prototype.render=function(a){function b(a){return a.nodeValue===d.beginCommentString?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var c=UkuleleUtil.getFinalValue(this.uku,a,this.attributeName);if(c){var d=this;if(this.element&&this.element.parentNode){this.beginCommentString="begin uku-repeat: "+this.expression+" in "+this.attributeName;var e=document.createComment(this.beginCommentString);this.element.parentNode.insertBefore(e,this.element),this.endCommentString="end uku-repeat: "+this.expression+" in "+this.attributeName;var f=document.createComment(this.endCommentString);this.element.parentNode.insertBefore(f,this.element.nextSibling),this.element.parentNode.removeChild(this.element)}for(var g=document.createTreeWalker(this.parentElement,NodeFilter.SHOW_COMMENT,b,!1);g.nextNode();){var h=g.currentNode;if(h&&h.nodeValue===this.beginCommentString){for(;h.nextSibling&&h.nextSibling.nodeValue!==this.endCommentString;)h.parentNode.removeChild(h.nextSibling);for(var i,j=0;j<c.length;j++){0!==j||i||(i=document.createElement("div"),h.parentNode.insertBefore(i,h.nextSibling));var k=c[j];i.insertAdjacentHTML("beforeBegin",this.renderTemplate);var l=i.previousSibling;l.removeAttribute("uku-repeat");var m=new Ukulele;m.parentUku=this.uku,m.registerController(this.expression,k),m.dealWithElement(l),j===c.length-1&&i.parentNode.removeChild(i)}}}if("OPTION"===this.element.tagName){var n=this.parentElement.getAttribute("uku-selected"),o=n.split("|");n=o[0],key=o[1];var p=this.uku.getFinalValueByExpression(n);key?this.parentElement.value=p[key]:this.parentElement.value=p}}},ControllerModel.prototype.addBoundItem=function(a){this.boundItems.push(a)},ControllerModel.prototype.getBoundItemsByName=function(a){for(var b=[],c=0;c<this.boundItems.length;c++){var d=this.boundItems[c];d.attributeName===a&&b.push(d)}return b},ObjectUtil.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},ObjectUtil.getType=function(a){var b=typeof a;return"object"===b&&ObjectUtil.isArray(a)?"array":b},ObjectUtil.compare=function(a,b){var c=ObjectUtil.getType(a),d=ObjectUtil.getType(b),e=!0;if(c!==d)return!1;switch(c){case"object":for(var f in a){var g=a[f],h=b[f],i=ObjectUtil.compare(g,h);if(!i){e=!1;break}}break;case"array":if(a.length===b.length)for(var j=0;j<a.length;j++){var k=a[j],l=b[j],m=ObjectUtil.compare(k,l);if(!m){e=!1;break}}else e=!1;break;case"function":e=a.toString()===b.toString();break;default:e=a===b}return e},ObjectUtil.deepClone=function(a){var b,c,d;if("object"!=typeof a||null===a)return a;if(a instanceof Array)for(b=[],c=0,d=a.length;d>c;c++)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c];else{b={};for(c in a)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c]}return b},UkuleleUtil.getFinalAttribute=function(a){var b=a.split("."),c=b.shift();return"parent"===c?UkuleleUtil.getFinalAttribute(b.join(".")):b.join(".")},UkuleleUtil.searchUkuAttrTag=function(a){var b=/^uku\-.*/,c=a.search(b);return c},UkuleleUtil.searchUkuExpTag=function(a){var b=/^\{\{.*\}\}$/,c=a.search(b);return c},UkuleleUtil.searchUkuFuncArg=function(a){var b=/\(.*\)$/,c=a.search(b);return c},UkuleleUtil.isRepeat=function(a){return a.getAttribute("uku-repeat")?!0:!1},UkuleleUtil.isInRepeat=function(a){for(var b=Selector.parents(a),c=0;c<b.length;c++){var d=b[c],e=d.getAttribute("uku-repeat");if(e)return!0}return!1},UkuleleUtil.getBoundModelInstantName=function(a){var b=a.split(".")[0];return b?b:null},UkuleleUtil.getAttributeFinalValue=function(a,b){var c=UkuleleUtil.getAttributeFinalValueAndParent(a,b),d=c.value;return d},UkuleleUtil.getAttributeFinalValueAndParent=function(a,b){var c,d=a;b=UkuleleUtil.getFinalAttribute(b);var e=b.split(".");if(""!==b&&d)for(var f=0;f<e.length;f++){var g=e[f];if(c=d,d=d[g],void 0===d||null===d)break}return{value:d,parent:c}},UkuleleUtil.getFinalValue=function(a,b,c,d){var e=UkuleleUtil.searchUkuFuncArg(c);if(-1===e)return UkuleleUtil.getAttributeFinalValue(b,c);var f=c.substring(0,e),g=UkuleleUtil.getAttributeFinalValueAndParent(b,f),h=g.value;if(void 0===h)return h;var i=c.substring(e+1,c.length-1);i=i.split(",");for(var j=[],k=0;k<i.length;k++){var l,m=i[k],n=a.getControllerModelByName(m);if(n&&n.controllerInstance){var o=n.controllerInstance;l=1===m.split(".").length?o:UkuleleUtil.getFinalValue(a,o,m)}else l=UkuleleUtil.getFinalValue(a,b,m);if(l!==b)j.push(l);else{var p=/\'.*\'/,q=m.search(p),r=/\".*\"/,s=m.search(r);-1!==q?(m=m.substring(1,m.length-1),j.push(m)):-1!==s?(m=m.substring(1,m.length-1),j.push(m)):j.push(l)}}return d&&j.concat(d),h=h.apply(g.parent,j)};