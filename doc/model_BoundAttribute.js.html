<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: model/BoundAttribute.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: model/BoundAttribute.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author Huibin
 */
function BoundAttribute(attrName, ukuTag, expression, element,uku) {
    "use strict";
    this.attributeName = attrName;
    this.ukuTag = ukuTag;
    this.expression = expression;
    this.element = element;
    this.uku = uku;
    this.renderTemplate = undefined;
    this.parentElement = undefined;
    //this.parentUku = undefined;
    if (ukuTag === "repeat") {
        this.renderTemplate = element.outerHTML;
        this.parentElement = element.parentNode;
        //this.parentUku = parentUku;
    }
    this.previousSiblings = undefined;
    this.nextSiblings = undefined;
}
BoundAttribute.prototype.renderAttribute = function (controller) {
    var attr = this.attributeName;
    var key;
    var elementName = this.element.tagName;
    if(this.ukuTag === "selected" &amp;&amp; elementName === "SELECT"){
        var tempArr = this.attributeName.split("|");
        attr = tempArr[0];
        key = tempArr[1];
    }
    var finalValue = UkuleleUtil.getFinalValue(this.uku,controller,attr);
    if(this.ukuTag.search('data-item') !== -1){
    	finalValue = JSON.stringify(finalValue);
        this.element.setAttribute('data-item',finalValue);
    }else if(this.ukuTag === "selected" &amp;&amp; elementName === "SELECT"){
    	var value;
    	if(key){
    		value = finalValue[key];
    	}else{
    		value = finalValue;
    	}     
        this.element.value = value;
    }else if(this.element.getAttribute("type") === "checkbox"){
		this.element.setAttribute("checked",finalValue);
	}
	else if(this.ukuTag === "value"){
        this.element.value = finalValue;
    }
    else if(this.element.getAttribute("type") === "radio"){
        if(this.element.value === finalValue){
            this.element.setAttribute("checked",true);
        }
    }
    else{
        this.element.setAttribute(this.ukuTag, finalValue);
    }    
};

BoundAttribute.prototype.renderExpression = function (controller) {
    var finalValue = UkuleleUtil.getFinalValue(this.uku,controller,this.attributeName);
    Selector.directText(this.element,finalValue);
};

BoundAttribute.prototype.renderRepeat = function (controller) {
    var finalValue = UkuleleUtil.getFinalValue(this.uku,controller,this.attributeName);
    
    /*var index = $(this.element).index();
    if(index !== -1){
        this.previousSiblings = $(this.element).prevAll();
        this.nextSiblings = $(this.element).nextAll();
    }
    this.parentElement.children().remove();*/
    if(!finalValue){
        return;
    }
    /*for(var p=0;p&lt;this.previousSiblings.length;p++){
        this.parentElement.append(this.previousSiblings[p]);
    }*/
    
    for (var i=0;i&lt;finalValue.length;i++) {
        var item = finalValue[i];
        this.element.insertAdjacentHTML('beforeBegin',this.renderTemplate);
        var itemRender = this.element.previousSibling;
        itemRender.removeAttribute("uku-repeat");
        var ukulele = new Ukulele();
        ukulele.parentUku = this.uku;
        ukulele.registerController(this.expression, item);
        ukulele.dealWithElement(itemRender);
        
        if(i ===0){
            var beginComment = document.createComment("begin uku-repeat:"+this.expression);
            this.element.parentNode.insertBefore(beginComment,this.element);
        }
        
        if(i === finalValue.length-1){
            this.element.style.display = "none";
            this.element.parentNode.removeChild(this.element);
            this.element = itemRender;
            
            var endComment = document.createComment("end uku-repeat:"+this.expression);
            this.element.parentNode.insertAfter(endComment,this.element);
        }
    }
    /*for(var n=0;n&lt;this.nextSiblings.length;n++){
        this.parentElement.append(this.nextSiblings[n]);
    }*/
    if(this.element.tagName === "OPTION"){
    	var expression = this.parentElement.getAttribute("uku-selected");
    	var tempArr = expression.split("|");
		expression = tempArr[0];
		key = tempArr[1];
    	var value = this.uku.getFinalValueByExpression(expression);
    	if(key){
    		this.parentElement.value = value[key];
    	}else{
    		this.parentElement.value = value;
    	}
    	
    }
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Ukulele.html">Ukulele</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BoundAttribute">BoundAttribute</a></li><li><a href="global.html#ControllerModel">ControllerModel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Sun Aug 23 2015 20:27:47 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
